{% load static %}
<!DOCTYPE html>
<html>

<head>
    <!-- Basic Page Info -->
    <meta charset="utf-8">
    <title>Barangay AI</title>

    <!-- Site favicon -->
    <!-- Site favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'src/images/BAi_LOGO.png' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'src/images/BAi_LOGO.png' %}" />

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/core.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/icon-font.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-119386393-1');
    </script>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            background-image: url("{% static 'src/images/hall.jpg' %}");
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        .login-header {
            width: 100%;
            height: 75px;
            background-image: url("{% static 'src/images/header1.png' %}");
            background-size: cover;
            background-position: center;
            position: fixed;
            z-index: 100;
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 65px;
        }


        .login-header .logo-text {
            color: #ffffff;
            font-weight: bold;
            font-size: 19px;
            margin-left: 10px;
        }

        .login-header .brand-logo {
            display: flex;
            align-items: center;
        }

        .login-header img {
            height: 50px;
            margin-right: 10px;
        }


        .form-control {
            border-radius: 8px;
            font-size: 12px;
        }

        .login-wrap {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            margin-top: 60px;
        }

        .login-container {
            display: grid;
            place-items: center;
            height: 100vh;
        }


        .login-box {
            max-width: 430px;
            width: 200%;
            height: 95%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            border-color: #ffffff;
            margin-bottom: 10px;
        }

        .btn-primary {
            background-color: #4CAF50;
            border: none;
            border-radius: 8px;

        }

        .btn-outline-primary {
            border: 2px solid #4CAF50;
            color: #4CAF50;
            border-radius: 20px;
        }

        .btn-outline-primary:hover {
            background-color: #4CAF50;
            color: white;
        }

        .btn-outline-secondary {
            border-radius: 10px;
        }

        .input-group.custom .form-control {
            width: 100%;
            height: 45px;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 7px;
            border: 1px solid #ccc;
            margin-top: -5px;

        }

        .input-group.custom .form-control:focus {
            border-color: #4CAF50;
            /* Set border color on focus */
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
            /* Add subtle shadow on focus */
        }

        .login-header .brand-logo a {
            cursor: default;
        }

        .login-title h5 {
            margin-bottom: -15px;
            /* Adjusted spacing below the title */
            text-align: center;
            color: #4CAF50;
            font-weight: 600;
        }

        .input-group.custom:first-of-type {
            margin-top: -5px;
            /* Adjust spacing above the first input field */
        }

        .login-box h6.mb-30 {
            margin-top: -20px;
            margin-bottom: 20px;
            /* Apply negative margin to bring it closer to h5 */
        }

        .fas.fa-exclamation-circle {
            font-size: 150px;
            color: red;

        }

        .password-policy {
            margin-top: -15px;
            font-size: 12px;
            color: rgb(65, 63, 63);
        }

        .requirement-list {
            list-style-type: none;
            padding-left: 0;
            color: red;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .requirement-item i {
            margin-right: 10px;
            color: #f44336;
        }

        .requirement-item.valid i {
            color: #4caf50;
        }

        .requirement-item.valid {
            color: #4caf50;
        }

        .pp-header {
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Style for password policy list */
        .password-policy .requirement-list {
            list-style-type: none;
            padding-left: 0;
        }

        .password-policy .requirement-list li {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .password-policy .requirement-list li i {
            font-size: 16px;
            margin-right: 10px;
            border-radius: 50%;
            width: 17px;
            height: 17px;
            display: inline-block;
            text-align: center;
            line-height: 18px;
            border: 2px solid #4CAF50;
            color: transparent;
            /* Initially hide icon */
            background-color: transparent;
        }

        /* Apply the check (✔) and cross (❌) icons */
        .password-policy .requirement-list li i.pass-valid {
            color: #4CAF50;
            content: '✔';
            background-color: #4CAF50;
        }

          .requirement-list li {
            list-style: none;
            margin-bottom: 8px;
        }

        .requirement-list input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.5); /* To make the checkbox larger */
        }

        .text-success {
            color: green;
        }

        .text-danger {
            color: red;
        }
    </style>
</head>

<body>
    <div class="login-header box-shadow">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="brand-logo d-flex align-items-center">
                <a href="#">
                    <img src="{% static 'src/images/BAi_LOGO.png' %}" alt="">
                    <span class="logo-text">Barangay AI</span>
                </a>
            </div>
        </div>
    </div>
    <div class="login-wrap d-flex align-items-center justify-content-center" style="min-height: 100vh;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="login-box bg-white box-shadow border-radius-10 p-4">
                        <i class="fas fa-exclamation-circle" style="font-size: 24px; color: red;"></i>

                        <div class="login-title">
                            <h5 class="text-center text-primary margin-bottom -10px">Forgot your password?</h5>
                        </div>
   <form action="{% url 'forgotpassword' %}" method="post" id="resetForm">
            {% csrf_token %}
            <div class="input-section">
                <!-- Email Field -->
                <div class="input-group custom mb-3">
                    <input type="email" maxlength="50" id="email" class="form-control" name="email" required placeholder="Enter Email address">
                </div>

                <!-- Password Field -->
                <div class="input-group custom mb-3">
                    <input type="password" maxlength="50" id="password" class="form-control" name="password" required placeholder="Enter New Password">
                </div>

                <!-- Password Policy -->
                <div class="password-policy p-0 pt-2 ps-2">
                    <span class="pp-header">Password must contain:</span>
                    <ul class="requirement-list p-0">
                        <li>
                            <input type="checkbox" id="rule-1" disabled>
                            <span id="rule-1-text" class="text-danger">At least 1 number (0...9)</span>
                        </li>
                        <li>
                            <input type="checkbox" id="rule-2" disabled>
                            <span id="rule-2-text" class="text-danger">At least 8 characters</span>
                        </li>
                        <li>
                            <input type="checkbox" id="rule-3" disabled>
                            <span id="rule-3-text" class="text-danger">At least 1 lowercase letter (a...z)</span>
                        </li>
                        <li>
                            <input type="checkbox" id="rule-4" disabled>
                            <span id="rule-4-text" class="text-danger">At least 1 uppercase letter (A...Z)</span>
                        </li>
                        <li>
                            <input type="checkbox" id="rule-5" disabled>
                            <span id="rule-5-text" class="text-danger">At least 1 special character (!@#$%^&*)</span>
                        </li>
                    </ul>
                </div>

                <!-- Confirm Password Field -->
                <div class="input-group custom mb-3">
                    <input type="password" id="confirm-password" class="form-control" name="confirm_password" required placeholder="Confirm New Password">
                </div>
                <div class="error-message" id="error-confirm-password">
                    Passwords do not match.
                </div>
            </div>

            <!-- Submit and Cancel Buttons -->
            <div class="row align-items-center">
                <div class="col-12 d-flex justify-content-between">
                    <a class="btn btn-outline-secondary mx-2" href="{% url 'login' %}">Cancel</a>
                    <input class="btn btn-primary" type="submit" value="Reset">
                </div>
            </div>
        </form>
            <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script>
        document.addEventListener("DOMContentLoaded", () => {
            const passwordField = document.getElementById("password");
            const confirmPasswordField = document.getElementById("confirm-password");
            const errorConfirmPassword = document.getElementById("error-confirm-password");

            // Password rules
            const rules = {
                rule1: /\d/, // At least 1 number
                rule2: /.{8,}/, // At least 8 characters
                rule3: /[a-z]/, // At least 1 lowercase letter
                rule4: /[A-Z]/, // At least 1 uppercase letter
                rule5: /[!@#$%^&*]/ // At least 1 special character
            };

            // Update the password rule indicators
            const updateRules = (value) => {
                Object.keys(rules).forEach((rule, index) => {
                    const checkbox = document.getElementById(`rule-${index + 1}`);
                    const text = document.getElementById(`rule-${index + 1}-text`);
                    if (rules[rule].test(value)) {
                        checkbox.checked = true;
                        text.classList.remove("text-danger");
                        text.classList.add("text-success");
                    } else {
                        checkbox.checked = false;
                        text.classList.remove("text-success");
                        text.classList.add("text-danger");
                    }
                });
            };

            // Validate passwords match
            const validatePasswordsMatch = () => {
                if (passwordField.value !== confirmPasswordField.value) {
                    errorConfirmPassword.style.display = "block";
                } else {
                    errorConfirmPassword.style.display = "none";
                }
            };

            // Event listeners for real-time validation
            passwordField.addEventListener("input", (e) => updateRules(e.target.value));
            confirmPasswordField.addEventListener("input", validatePasswordsMatch);

            // Form submission validation
            document.getElementById("resetForm").addEventListener("submit", (e) => {
                const allRulesMet = Object.values(rules).every((rule) => rule.test(passwordField.value));
                if (!allRulesMet || passwordField.value !== confirmPasswordField.value) {
                    e.preventDefault(); // Prevent form submission
                    showCustomModal("Password Policy Not Met", "Please ensure all password requirements are met.");
                }
            });
        });

        // Custom modal using SweetAlert2
        const showCustomModal = (title, message) => {
            Swal.fire({
                title: title,
                text: message,
                icon: "error",
                confirmButtonText: "OK"
            });
        };
    </script>

                    
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="col-2">
        <div class="font-16 weight-600 text-center" data-color="#707373">OR</div>
    </div>
    <div class="col-5">
        <div class="input-group mb-0">
            <a class="btn btn-outline-primary btn-lg btn-block" href="{% url 'login' %}">Login</a>
        </div>
    </div>
    </div>




    <!--sweet alert -->

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        {% if password_chanaged %}
        Swal.fire({
            title: 'Password Changed Successfully!',
            icon: 'success',
            confirmButtonText: 'Log In',
            confirmButtonColor: '#3085d6',
            showCancelButton: true,
            cancelButtonText: 'Close',
            cancelButtonColor: '#d33',
            customClass: {
                popup: 'custom-swal-popup'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "{% url 'login' %}";
            } else if (result.dismiss === Swal.DismissReason.cancel) {
                console.log("Popup closed");
            }
        });
       
        {% endif %}

        {% if account %}


        Swal.fire({
            title: 'Email Address is not registred!',
            icon: 'error',
            confirmButtonText: 'Chanage Password',
            confirmButtonColor: '#3085d6',
            showCancelButton: true,
            cancelButtonText: 'Close',
            cancelButtonColor: '#d33',
            customClass: {
                popup: 'custom-swal-popup'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "{% url 'forgotpassword' %}";
            } else if (result.dismiss === Swal.DismissReason.cancel) {
                console.log("Popup closed");
            }
        });

        {% endif %}
    });
</script>

    <!-- end of sweet alert -->

    <!-- js -->
    <script src="{% static 'vendors/scripts/core.js' %}"></script>
    <script src="{% static 'vendors/scripts/script.min.js' %}"></script>
    <script src="{% static 'vendors/scripts/process.js' %}"></script>
    <script src="{% static 'vendors/scripts/layout-settings.js' %}"></script>

</body>

</html>